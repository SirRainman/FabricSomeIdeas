# 思考问题的方法

1. 目前解决该问题的技术路线？
   1. Docker
   2. Docker Swarm
   3. Kubernetes 
2. 各种技术路线的深度分析
   1. 技术难点
   2. 优势
   3. 缺陷
   4. 每个技术路线最终可以实现的效果
3. 目前最好的技术路线的缺陷是什么？
4. 自己使用什么样的技术路线？
1. 该技术路线解决目前的痛点问题
   2. 该技术路线的缺点？

# 一、大宗商品BaaS需要解决问题？

需要解决的问题：

1. 帮助每一位使用该平台的用户，根据自己的需要，在自己的组织内实现节点的快速部署与管理，同时可以进行一些区块链服务调用，如channel的创建和加入，链码的安装与调用。
2. 可以让用户专注于快速创建、管理和监控区块链网络，不需要过多的关注底层的硬件资源。



自己的问题：

1. Fabric Java SDK和该区块链BaaS平台的关系是什么？
2. Fabric Java sdk 部署在哪里？只部署在一个地方嘛？
   1. 我个人感觉对于每一个组织都应该部署一个Java sdk把？不然只有一个Java sdk来接受用户对区块链的请求是不是有点中心化的思想在里面了？
   2. 如果每个组织都部署一个fabric sdk 那么 他们和kubernetes的关系是什么啊？
   3. 因为每个组织都有自己的区块链节点，因此他们对于自己的区块链进行操作时，是不是需要有自己的fabric sdk来提供服务，如果是这样的话，fabric sdk 是不是运行在容器中比较好？
3. 怎么动态的向区块链网络中添加一个组织/节点？
   1. 动态的加入一个组织的过程中发生了什么事情？
   2. 添加组织/节点的工作肯定是由kubernetes来完成，那么怎么吧eyfn中实现的步骤，与kubernetes结合起来呢？
4. 怎么把kubernetes对用户的权限控制 和 fabric 对用户的权限控制结合起来？？
   1. kuberntes可以通过权限管理技术，限制一个用户的权限，即创建peer节点、orderer节点的权限。
   2. fabric 对用户的权限管理是怎么实现的？即一个用户在区块链中可以干什么事情，不可以干什么事情，fabric是怎么限定用户的权限的？
   3. 怎么把kubernetes对用户的权限管理 和 fabric 的权限管理结合在一起？
5. 在fabric-samples中crypto-config文件夹充当的是什么角色？
   5. CA在fabric中扮演的是什么角色？他和证书与密钥是什么关系？
   2. 怎么使用fabric ca？
   3. 区块链中所有的节点都去ca完成注册并拿到证书吗？
6. 怎么保存/管理用户的证书？密钥？
   1. 当系统启动起来时，Fabric Java SDK 的证书从哪里获取？
   2. 用户的证书 和 kubernetes中实现用户的身份认证的证书有什么关系？
   3. 阿里是怎么利用TEE来管理用户的密钥的？
   4. 

---

# 二、BaaS 系统架构

## 1 系统架构

1. 应用层：向应用开发者 和 平台管理员提供不同的操作管理能力
2. 核心层：完成系统的 资源编排、系统监控、数据分析 和 权限管理 等重要功能
3. 底层驱动：访问 和 管理 多种物理资源

## 2 BaaS 各组件的功能

a) 对用户提供

1. 权限/证书管理：不同的用户具备不同的 数据/请求 权限（权限管理属于那一部分？权限管理管理的是什么权限？），通过带认证的接口，用户根据自己的权限可以访问区块链网络，安装智能合约并进行调用。
2. 节点管理：管理区块链网络节点，一键式快速创建和部署生产级区块链环境，简化区块链的部署流程和应用配置。
3. 通道管理：可以创建&删除通道，管理通道的声明周期（事实上是区块链的生命周期的管理工作）
4. 智能合约管理：管理智能合约的生命周期，完成一键式的智能合约的部署与调用。
5. 区块链服务：fabric Java sdk 的安装与调用，使用fabric Java sdk提供区块链服务（fabric sdk应该可以调用kubernetes sdk的把？Fabric Java SDK 和 Kubernetes Java SDK 是同级关系嘛？这两个SDK部署在哪里？也是部署在容器中嘛？）
6. 监控服务：监控区块链网络的具体工作情况，如区块数目情况，交易数目情况（Fabric explorer 等类似的区块链浏览器）



b) 对管理员提供

1. 用户管理：（这里的用户管理管理的是什么用户？这里的用户实际上指的就是可以创建节点的某一组织内的用户）
2. 资源管理：容器节点的编排功能（计算资源、存储资源、网络资源这些是否支持动态扩容？？），使用kubernetes Java sdk 提供容器编排的服务
3. 节点监控服务：监控区块链网络中各个节点是否在正常的工作
4. 请求分析：分析各个请求的响应时间



3) 平台提供

1. 高性能：区块链节点具备处理高并发的交易的能力（需要对fabric源码进行修改工作，将源码编译成镜像，把镜像交由kubernetes进行管理工作）

2. 可扩展硬件资源：可以跨区域的扩展BaaS平台的硬件资源（Kubernetes可以扩展硬件资源吗？）

3. 资源/请求调度：调度不均匀的用户请求/资源请求（这个资源的请求调度应该通过什么模块完成？）

4. 安全：

   1. 节点工作的安全性
   2. 节点中用户数据的安全性

   

---

# 三、技术路线

## 1 Kubernetes

动态的添加/管理一些容器，可以使用kubernetes java client项目来完成容器的编排工作，通过kubernetes java client客户端可以完成对kubenetes原生资源对象（pod、node、namespace、servcie、deployment）和自定义资源对象（如：cluster）的增删改查或事件监听（watch）。



Kubernetes Java client 通过运用什么技术完成容器的编排工作？

Kubernetes Java client 调用RESP API完成对分布式容器集群的编排工作。其中REST API 是 Kubernetes 的基础架构，kubernetes组件之间的所有操作和通信，以及外部用户命令都是 API Server 处理的 REST API 调用。因此，Kubernetes 平台中的所有资源被视为 API 对象，并且在API中都有对应的定义项。



Kubernetes 如何实现对用户的身份进行认证？

[Kubernetes身份认证策略](https://jimmysong.io/kubernetes-handbook/guide/authentication.html)。

Kubernetes 使用客户端证书、bearer token、身份验证代理或者 HTTP 基本身份验证等身份认证插件来对 API 请求进行身份验证。当有 HTTP 请求发送到 API server 时，插件会尝试将以下属性关联到请求上：

- 用户名：标识最终用户的字符串。常用值可能是 `kube-admin` 或 `jane@example.com`。
- UID：标识最终用户的字符串，比用户名更加一致且唯一。
- 组：一组将用户和常规用户组相关联的字符串。
- 额外字段：包含其他有用认证信息的字符串列表的映射。



## 2 Fabric 

[fabric java sdk 使用的简单介绍](https://uzshare.com/view/822302)

使用Fabric Java SDK完成和区块链节点的交互工作。可以通过该Fabric Java SDK完成对channel和chaincode的生命周期的管理工作，同时可也以完成执行用户的链码，查询区块和查询交易等信息。

channel

1. 创建channel
2. 加入channel

chaincode

1. 打包链码
2. 安装链码
3. 查询是否安装成功
4. 在某组织内同意/审批链码的安装
5. 查询链码是否经过同意/审批
6. 提交链码
7. 测试执行链码



## 3 数据流图

1. 用户注册、登陆
   1. kubernetes sdk 负责
   2. 完成对用户赋予权限的过程
2. 进入到节点管理界面：用户添加主机、添加组织、添加peer节点、添加orderer节点
   1. kubernetes sdk 负责
   2. 这个平台应该只有一个，他负责为每个用户提供创建区块链节点的功能，因为每个用户的权限不同，所以并不是每个用户都有创建区块链节点的功能。
3. 进入到区块链服务界面：创建channel、peer加入channel、管理chaincode的生命周期
   1. fabric sdk 负责
   2. 根据每个用户所拥有的权限，他们根据每个组织的fabric sdk所提供区块链服务，进行一些操作



## 阿里的技术路线

![阿里云-BaaS](http://qhczuqqky.hn-bkt.clouddn.com/img/BaaS_Doc_Images_v1.4.002-20201005153442362.jpeg)



## 腾讯TBaaS平台的技术架构

![腾讯TBaaS](http://qhczuqqky.hn-bkt.clouddn.com/img/image-20201005165404650.png)

---

# 四、BaaS 系统的评测指标-技术难点

## 1 性能指标

区块链节点和应用（智能合约）对交易的处理速度是否达到要求，即对交易的入链/查询的实时性的要求

可以做的点：

1. 改进fabric的peer/orderer的源码，加快交易的处理速度
2. 在调度层面做好负载均衡

## 2 可扩展性

是否具有大规模场景下的应用部署和管理的能力，是否可以跨区域的对云上硬件资源进行扩展。

## 3 资源调度

对于非均匀的资源请求可以实现智能调度，合理的分配系统的资源。

## 4 安全性

是否可以避免外部攻击和内部攻击，是否可以保障系统的容错性。

阿里

1. 使用TEE（如Intel SGX）技术，保护区块链的私钥安全；
2. 支持国密算法（SM234）；
3. 内置DDoS攻击防护
4. 支持子账号访问控制（这个怎么提供安全能力？）
5. 监控产品管理运维过程中的高风险操作，引入风控验证&日志审计功能

## 5 可感知性

深度感知用户的数据行为，可以评估用户链上账户的应用状态，主动提示用户。

## 6 底层资源普适性

底层可以支持多种混合的计算架构，可以导入多种异构的物理资源。

